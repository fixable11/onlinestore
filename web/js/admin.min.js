$(function(){function e(){var e={},a=$(".newCategory__inpNew").attr("name"),t=$(".newCategory__inpNew").val(),o=$(".newCategory__inpSym").attr("name"),n=$(".newCategory__inpSym").val();if(!t)return void alert("Пожалуйста введите название категории!");if(!n.trim())return void alert("Пожалуйста укажите символическую ссылку!");var c=$(".newCategory__selectAdd option:selected").val();e[a]=t,e.generalCatId=c,e[o]=n,console.log(e),$.ajax({type:"POST",async:!0,data:e,url:"/admin/addnewcat/",dataType:"json",success:function(e){console.log(e),e.success?(alert(e.message),$(".newCategory__select").append('<option class="newCategory__option" value="'+e.id+'">'+e.name+"</option>"),$(".newCategory__td .select-options").append('<li class="select-option" rel="'+e.id+'">'+e.name+"</li>")):alert(e.message)},error:function(e,a,t){alert("Ошибка добавления категории!"),console.log(e.responseText),console.log(a),console.log(t)}})}function a(){var e={},a=$(".newCategory__selectDelete option:selected"),t=a.val(),o=a.text();e.catId=t,e.catName=o,confirm("Вы уверены что хотите удалить категорию '"+o+"'")&&$.ajax({type:"POST",async:!0,data:e,url:"/admin/deletecat/",dataType:"json",success:function(e){console.log(e),e.success?(alert(e.message),$(".select-options li").each(function(a,t){$(t).attr("rel")==e.catId&&$(t).remove()}),$("#newCategoryName").val("")):alert(e.message)},error:function(e,a,t){console.log(e.responseText),console.log(a),console.log(t)}})}function t(){var e=$(".addProduct__addName").val(),a=$(".addProduct__addPrice").val(),t=$(".addProduct__addSelect option:selected").val(),o=$(".addProduct__addDesc").val(),n={itemName:e,itemPrice:a,itemCatId:t,itemDesc:o};$.ajax({type:"POST",async:!0,data:n,url:"/admin/addproduct/",dataType:"json",success:function(e){console.log(e),e.success?(alert(e.message),window.location.href="/admin/products/"):alert(e.message)},error:function(e,a,t){console.log(e.responseText),console.log(a),console.log(t)}})}function o(e){var a=$(".addProduct__inpName[data-id ="+e+"]").val(),t=$(".addProduct__inpPrice[data-id ="+e+"]").val(),o=$(".addProduct__select[data-id ="+e+"]").children("option:selected").val(),n=$(".addProduct__textarea[data-id ="+e+"]").val(),c=$(".addProduct__checkbox[data-id ="+e+"]").prop("checked");c=c?0:1;var d={itemId:e,itemName:a,itemPrice:t,itemCatId:o,itemDesc:n,itemStatus:c};$.ajax({type:"POST",async:!0,data:d,url:"/admin/updateproduct/",dataType:"json",success:function(e){e.success&&(console.log(e),alert(e.message))},error:function(e,a,t){console.log(e.responseText),console.log(a),console.log(t)}})}function n(e){var a=new FormData;console.log(t);var t=$(".addProduct__inpId[data-id ="+e+"]"),o=$(".addProduct__inpFile[data-id ="+e+"]");console.log(o);var n=o[0].files[0];a.append(o.attr("name"),n),a.append(t.attr("name"),t.val()),$.ajax({type:"POST",async:!0,data:a,url:"/admin/upload/",dataType:"json",processData:!1,contentType:!1,success:function(a){console.log(a);var t=a.src;console.log(t),$(".addProduct__img[data-id ="+e+"]").prop("src",t+"?"+(new Date).valueOf()),$(".addProduct__filePath").text(""),alert(a.message)},error:function(e,a,t){console.log(e.responseText),console.log(a),console.log(t)}})}function c(e){$(".adminOrders__tr[data-id="+e+"]").fadeToggle()}function d(e){var a=$(".changeCategory__input[data-id ="+e+"]").val(),t=$(".changeCategory__select[data-id ="+e+"]").children("option:selected").val();console.log(t);var o={itemId:e,parentId:t,newName:a};$.ajax({type:"POST",async:!0,data:o,url:"/admin/updatecategory/",dataType:"json",success:function(e){console.log(e),alert(e.message)},error:function(e,a,t){console.log(e.responseText),console.log(a),console.log(t)}})}function s(e){var a=$(".adminOrders__checkbox[data-id ="+e+"]").prop("checked");a=a?1:0;var t={itemId:e,status:a};$.ajax({type:"POST",async:!0,data:t,url:"/admin/setorderstatus/",dataType:"json",success:function(e){e.success||alert(e.message)},error:function(e,a,t){console.log(e.responseText),console.log(a),console.log(t)}})}function r(e){var a=$(".adminOrders__inputDate[data-id ="+e+"]").val(),t={itemId:e,datePayment:a};$.ajax({type:"POST",async:!0,data:t,url:"/admin/setorderdatepayment/",dataType:"json",success:function(e){e.success,alert(e.message)},error:function(e,a,t){console.log(e.responseText),console.log(a),console.log(t)}})}$(".newCategory__add").on("click",function(a){a.preventDefault(),e()}),$(".newCategory__delete").on("click",function(e){e.preventDefault(),a()}),$(".changeCategory__btn").on("click",function(e){e.preventDefault(),d($(this).attr("data-id"))}),$(".updateProduct").on("click",function(e){e.preventDefault(),o($(this).attr("data-id"))}),$(".addProduct__inpFile").on("change",function(e){e.preventDefault();var a=$(this).val().replace(/.*\\/,"");$(".addProduct__filePath").text(a)}),$(".addProduct__addBtn").on("click",function(e){e.preventDefault(),t()}),$(".addProduct__changeBtn").on("click",function(e){e.preventDefault(),o($(this).attr("data-id"))}),$(".addProduct__submit").on("click",function(e){e.preventDefault(),n($(this).attr("data-id"))}),$(".addProduct__inpFile").on("change",function(e){e.preventDefault();$(this).val().replace(/.*\\/,"")}),$(".adminOrders__showBtn").on("click",function(e){c($(this).attr("data-id"))}),$(".adminOrders__checkbox").on("click",function(e){s($(this).attr("data-id"))}),$(".adminOrders__btnDate").on("click",function(e){r($(this).attr("data-id"))})});